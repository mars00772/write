#Dapper，大规模分布式系统的跟踪系统

------
感谢网友[bigbully ](https://github.com/bigbully/Dapper-translation)的翻译，造福我等英盲人。以下是我摘抄笔记。


------
[TOC]

###概述
>* 当代的互联网服务是由结构复杂的大规模分布式集群实现
>* 需要可以帮助理解系统行为，分析性能的工具，google中发明了Drapper--一种大规模的分布式跟踪系统
>* Drapper它是如何满足一个**低损耗、应用透明的、大范围部署**这三个需求的
>* Dapper是怎么构建和部署的
>* 介绍一些使用Dapper搭建的分析工具，分享一下这些工具在google内部使用的统计数据
>* 展现一些使用场景，最后会讨论一下我们迄今为止从Dapper收获了些什么
###介绍

>* 为了能在分布式系统中帮助开发者理解横跨不同APP，服务器之间的关联动作，Drapper收集更多的复杂分布式系统的行为信息

#### Universal Search Example
>* 前端服务--》上百个独立index的查询服务器--》各自发送到多个子系统--》分别处理广告，拼写检查，查找图片、视频或新闻。---》子系统筛选结果，得到结果。期间可能调用了上千个服务器，工程师只能知道这个查询耗时过长，但无从知晓问题到底是由于哪个服务调用导致。
>* 系统任何时间可能被修改上线过，不可苛求工程师对这次universal search了如指掌(我发现系统越来越大后，新人做事愈发捻手捻脚，何况我等系统已经足够小了)
>* 对Drapper的要求结论：无所不在的部署，持续的监控。
####Design goals
>* 1.低消耗：跟踪系统对在线服务的影响应该做到足够小。在一些高度优化过的服务，即使一点点损耗也会很容易察觉到，而且有可能迫使在线服务的部署团队不得不将跟踪系统关停。（哈哈哈。。。。）
>* 2.应用级的透明：对于应用的程序员来说，是不需要知道有跟踪系统这回事的。如果一个跟踪系统想生效，就必须需要依赖应用的开发者主动配合，那么这个跟踪系统也太脆弱了，往往由于跟踪系统在应用中植入代码的bug或疏忽导致应用出问题，这样才是无法满足对跟踪系统“无所不在的部署”这个需求。面对当下想Google这样的快节奏的开发环境来说，尤其重要。（我司层内部trace显著入侵业务代码，令我印象非常深刻）
>* 3.延展性：Google至少在未来几年的服务和集群的规模，监控系统都应该能完全把控住。
一个额外的设计目标是为跟踪数据产生之后，进行分析的速度要快，理想情况是数据存入跟踪仓库后一分钟内就能统计出来。尽管跟踪系统对一小时前的旧数据进行统计也是相当有价值的，但如果跟踪系统能提供足够快的信息反馈，就可以对生产环境下的异常状况做出快速反应。

做到真正的应用级别的透明，这应该是当下面临的最挑战性的设计目标，我们把核心跟踪代码做的很轻巧，然后把它植入到那些无所不在的公共组件种，比如**线程调用、控制流以及RPC库**。使用**自适应的采样率**可以使跟踪系统变得可伸缩，并降低性能损耗，这些内容将在第4.4节中提及。
###Summary of contributions
###2. Dapper的分布式跟踪
![tup](https://raw.githubusercontent.com/mars00772/write/master/drapper/server_call.jpg)







> Written with [StackEdit](https://stackedit.io/).